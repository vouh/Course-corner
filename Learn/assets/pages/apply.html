<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apply – Course Corner Learn</title>
    <link rel="icon" href="/favicon.ico" sizes="any">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        *{box-sizing:border-box;margin:0;padding:0}
        body{font-family:'Inter',sans-serif;background:#f9fafb;color:#1f2937}
        /* Nav visibility */
        @media(min-width:1025px){.desktop-nav{display:flex!important;align-items:center;}.mobile-menu-btn{display:none!important;}}
        @media(max-width:1024px){.desktop-nav{display:none!important;}.mobile-menu-btn{display:flex!important;}}
        .mobile-menu.show{height:auto!important;max-height:calc(100vh - 64px);opacity:1!important;overflow-y:auto;border-bottom:1px solid #e5e7eb;box-shadow:0 10px 40px rgba(0,0,0,.1)}
        .mobile-menu-btn.active span:nth-child(1){transform:translateY(6px) rotate(45deg)}
        .mobile-menu-btn.active span:nth-child(2){opacity:0}
        .mobile-menu-btn.active span:nth-child(3){transform:translateY(-6px) rotate(-45deg)}
        .mobile-menu-btn span{display:block;transition:all .3s;background-color:#1f2937!important}
        .modern-header{background:rgba(255,255,255,0.97)!important;backdrop-filter:blur(12px)!important}
        .form-input{width:100%;padding:.75rem 1rem;border:1.5px solid #e5e7eb;border-radius:.75rem;font-size:.9375rem;transition:all .2s;font-family:inherit}
        .form-input:focus{outline:none;border-color:#16a34a;box-shadow:0 0 0 3px rgba(22,163,74,.1)}
        textarea.form-input{resize:vertical;min-height:100px}
        .cc-footer{background:linear-gradient(135deg,#16a34a 0%,#15803d 100%);color:white;padding:4rem 2rem 2rem;border-top:3px solid #16a34a}
        .cc-footer-container{max-width:1240px;margin:0 auto}
        .cc-footer-grid{display:grid;grid-template-columns:2fr 1fr 1fr 1fr;gap:3rem;padding-bottom:3rem;border-bottom:1px solid rgba(255,255,255,.08);margin-bottom:2rem}
        .cc-footer-links h4{font-size:.75rem;font-weight:700;color:white;margin-bottom:1.25rem;letter-spacing:.1em;text-transform:uppercase}
        .cc-footer-links ul{list-style:none}
        .cc-footer-links li{margin-bottom:.75rem}
        .cc-footer-links a{color:rgba(255,255,255,.85);text-decoration:none;font-size:.9375rem;transition:all .2s}
        .cc-footer-links a:hover{color:white;padding-left:4px}
        .cc-footer-bottom{text-align:center;font-size:.875rem;color:rgba(255,255,255,.75);padding-top:1.5rem}
        @media(max-width:768px){.cc-footer-grid{grid-template-columns:1fr}}
    </style>
</head>
<body>

<!-- ═══ HEADER ════════════════════════════════════════════════ -->
<header class="modern-header fixed top-0 left-0 right-0 w-full z-[1000] bg-white/95 backdrop-blur-md border-b border-gray-100 transition-all duration-300" id="learnHeader">
    <div class="header-container flex items-center justify-between max-w-[1400px] mx-auto px-4 md:px-8 py-3">
        <a href="../../index.html" class="logo-container flex items-center gap-2.5 no-underline">
            <img src="https://coursecornerkenya.com/assets/images/logo.png" alt="Course Corner Logo" class="h-8 md:h-10 w-auto">
            <div class="logo-text-group flex flex-col justify-center leading-none gap-[2px]">
                <span class="text-[1.15rem] md:text-[1.35rem] font-extrabold text-[#16a34a] tracking-tight leading-none">Course Corner</span>
                <span class="text-[0.55rem] md:text-[0.65rem] font-semibold text-[#0ea5e9] tracking-wide leading-none">Learn Portal</span>
            </div>
        </a>
        <nav class="desktop-nav hidden lg:flex items-center gap-6">
            <a href="../../index.html" class="text-[0.9rem] font-semibold text-gray-600 hover:text-[#16a34a] no-underline transition-colors">Home</a>
            <a href="courses.html" class="text-[0.9rem] font-semibold text-gray-600 hover:text-[#16a34a] no-underline transition-colors">Courses</a>
            <a href="whats-new.html" class="text-[0.9rem] font-semibold text-gray-600 hover:text-[#16a34a] no-underline transition-colors">What's New</a>
            <a href="about.html" class="text-[0.9rem] font-semibold text-gray-600 hover:text-[#16a34a] no-underline transition-colors">About</a>
            <a href="resources.html" class="text-[0.9rem] font-semibold text-gray-600 hover:text-[#16a34a] no-underline transition-colors">Resources</a>
            <a href="payment.html" class="text-[0.9rem] font-semibold text-gray-600 hover:text-[#16a34a] no-underline transition-colors flex items-center gap-1"><i class="fas fa-credit-card text-xs"></i> Pay</a>
        </nav>
        <button id="mobileMenuBtn" class="mobile-menu-btn lg:hidden flex flex-col justify-center items-center gap-1.5 w-10 h-10 border-none bg-transparent cursor-pointer" aria-label="Toggle menu">
            <span class="w-6 h-0.5 bg-gray-800"></span>
            <span class="w-6 h-0.5 bg-gray-800"></span>
            <span class="w-6 h-0.5 bg-gray-800"></span>
        </button>
    </div>
    <div class="mobile-menu lg:hidden fixed top-[64px] left-0 right-0 h-0 opacity-0 overflow-hidden bg-white/98 backdrop-blur-xl transition-all duration-300 z-[999]" id="mobileMenu">
        <nav class="flex flex-col gap-2 p-6">
            <a href="../../index.html" class="p-4 text-lg font-bold text-gray-800 no-underline rounded-xl hover:bg-gray-50 transition-all" onclick="closeMobileMenu()">Home</a>
            <a href="courses.html" class="p-4 text-lg font-bold text-gray-800 no-underline rounded-xl hover:bg-gray-50 transition-all" onclick="closeMobileMenu()">Courses</a>
            <a href="whats-new.html" class="p-4 text-lg font-bold text-gray-800 no-underline rounded-xl hover:bg-gray-50 transition-all" onclick="closeMobileMenu()">What's New</a>
            <a href="about.html" class="p-4 text-lg font-bold text-gray-800 no-underline rounded-xl hover:bg-gray-50 transition-all" onclick="closeMobileMenu()">About</a>
            <a href="resources.html" class="p-4 text-lg font-bold text-gray-800 no-underline rounded-xl hover:bg-gray-50 transition-all" onclick="closeMobileMenu()">Resources</a>
            <a href="payment.html" class="p-4 text-lg font-bold text-gray-800 no-underline rounded-xl hover:bg-gray-50 transition-all flex items-center gap-2" onclick="closeMobileMenu()"><i class="fas fa-credit-card text-[#16a34a]"></i> Pay</a>
        </nav>
    </div>
</header>

<!-- Hero -->
<section class="pt-24 pb-8 px-4 md:px-8 bg-gradient-to-br from-gray-900 via-green-950 to-gray-900 text-white text-center">
    <div class="max-w-3xl mx-auto">
        <div class="inline-flex items-center gap-2 bg-green-500/15 border border-green-500/30 text-green-400 px-4 py-1.5 rounded-full text-sm font-semibold mb-6">
            <i class="fas fa-paper-plane"></i> Course Application
        </div>
        <h1 class="text-3xl md:text-4xl font-extrabold mb-3 tracking-tight">Apply for a Course</h1>
        <p class="text-gray-400 text-lg">Fill in the form below and we'll get back to you with enrollment details.</p>
    </div>
</section>

<!-- Application Form -->
<section class="max-w-2xl mx-auto px-4 py-12">
    <!-- Course Card (dynamically loaded) -->
    <div id="courseCard" class="bg-white rounded-2xl border border-gray-200 p-6 mb-8 shadow-sm hidden">
        <div class="flex items-center gap-4 mb-4">
            <div class="w-14 h-14 rounded-xl flex items-center justify-center text-2xl text-white flex-shrink-0" id="courseIcon" style="background:#16a34a">
                <i class="fas fa-graduation-cap"></i>
            </div>
            <div>
                <h3 class="text-xl font-extrabold text-gray-900" id="cardTitle">Loading...</h3>
                <p class="text-sm text-gray-500" id="cardMeta">...</p>
            </div>
        </div>
        <div class="flex items-center justify-between pt-4 border-t border-gray-100">
            <div>
                <span class="text-xs font-bold text-gray-400 uppercase">Course Fee</span>
                <p class="text-2xl font-extrabold text-[#16a34a]" id="cardFee">...</p>
            </div>
            <div class="flex gap-2">
                <span class="px-3 py-1 rounded-full text-xs font-bold bg-green-100 text-green-700" id="cardLevel">...</span>
                <span class="px-3 py-1 rounded-full text-xs font-bold bg-blue-100 text-blue-700" id="cardDuration">...</span>
            </div>
        </div>
    </div>

    <!-- Syllabus Preview (loaded dynamically) -->
    <div id="syllabusSection" class="bg-white rounded-2xl border border-gray-200 shadow-sm overflow-hidden mb-8 hidden">
        <div class="p-5 border-b border-gray-100 bg-gray-50/50 flex items-center justify-between">
            <h2 class="text-base font-extrabold text-gray-900 flex items-center gap-2">
                <i class="fas fa-list-check text-[#16a34a]"></i> Course Syllabus
            </h2>
            <a id="learnMoreBtn" href="#" class="inline-flex items-center gap-1.5 px-4 py-2 bg-[#16a34a] text-white rounded-lg text-sm font-bold hover:bg-[#15803d] transition-all shadow-sm">
                <i class="fas fa-info-circle"></i> Learn More
            </a>
        </div>
        <div id="syllabusContent" class="p-5 space-y-3"></div>
    </div>

    <!-- Form -->
    <div class="bg-white rounded-2xl border border-gray-200 shadow-sm overflow-hidden">
        <div class="p-6 border-b border-gray-100 bg-gray-50/50">
            <h2 class="text-lg font-extrabold text-gray-900 flex items-center gap-2">
                <i class="fas fa-user-edit text-[#16a34a]"></i> Application Form
            </h2>
            <p class="text-sm text-gray-500 mt-1">All fields marked with * are required</p>
        </div>
        <form id="applyForm" class="p-6 space-y-5">
            <input type="hidden" id="appliedCourseId" name="courseId">

            <div>
                <label class="block text-sm font-bold text-gray-700 mb-1.5">Select Course *</label>
                <select id="courseSelect" name="courseId" class="form-input" required onchange="onCourseChange()">
                    <option value="">-- Choose a package --</option>
                </select>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-1.5">Full Name *</label>
                    <input id="appName" name="fullName" type="text" class="form-input" placeholder="Jane Doe" required>
                </div>
                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-1.5">Email Address *</label>
                    <input id="appEmail" name="email" type="email" class="form-input" placeholder="you@example.com" required>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-1.5">WhatsApp Number *</label>
                    <input id="appWhatsApp" name="whatsapp" type="tel" class="form-input" placeholder="0712 345 678" required>
                </div>
                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-1.5">Location *</label>
                    <input id="appLocation" name="location" type="text" class="form-input" placeholder="e.g. Nairobi, Kisumu" required>
                </div>
            </div>

            <div>
                <label class="block text-sm font-bold text-gray-700 mb-1.5">Do you own a laptop? *</label>
                <div class="flex gap-4 mt-1">
                    <label class="flex items-center gap-2 cursor-pointer px-4 py-2.5 rounded-xl border border-gray-200 hover:border-[#16a34a] transition-all has-[:checked]:bg-green-50 has-[:checked]:border-[#16a34a]">
                        <input type="radio" name="hasLaptop" value="yes" required class="accent-[#16a34a]">
                        <span class="text-sm font-semibold text-gray-700"><i class="fas fa-laptop text-[#16a34a] mr-1"></i> Yes</span>
                    </label>
                    <label class="flex items-center gap-2 cursor-pointer px-4 py-2.5 rounded-xl border border-gray-200 hover:border-[#16a34a] transition-all has-[:checked]:bg-green-50 has-[:checked]:border-[#16a34a]">
                        <input type="radio" name="hasLaptop" value="no" required class="accent-[#16a34a]">
                        <span class="text-sm font-semibold text-gray-700"><i class="fas fa-times-circle text-gray-400 mr-1"></i> No</span>
                    </label>
                </div>
            </div>

            <div>
                <label class="block text-sm font-bold text-gray-700 mb-1.5">Why are you interested? (Optional)</label>
                <textarea id="appMessage" name="message" class="form-input" placeholder="Tell us a bit about your goals..."></textarea>
            </div>

            <button type="submit" class="w-full py-4 bg-[#16a34a] text-white rounded-xl font-bold text-lg hover:bg-[#15803d] transition-all shadow-lg shadow-green-600/20 flex items-center justify-center gap-2">
                <i class="fas fa-paper-plane"></i> Submit Application
            </button>

            <p class="text-center text-xs text-gray-400 mt-2">By submitting, you agree to receive enrolment updates via WhatsApp and Email.</p>
        </form>
    </div>
</section>

<!-- ═══ FOOTER ════════════════════════════════════════════════ -->
<footer class="cc-footer">
    <div class="cc-footer-container">
        <div class="cc-footer-grid">
            <div class="cc-footer-brand">
                <div class="flex items-center gap-2 mb-4">
                    <img src="https://coursecornerkenya.com/assets/images/logo.png" class="h-10 w-auto" alt="Course Corner logo" />
                    <div class="flex flex-col leading-none">
                        <span class="text-white font-extrabold text-lg">Course Corner</span>
                        <span class="text-blue-400 font-bold text-[0.6rem] uppercase tracking-wider">Learn Portal</span>
                    </div>
                </div>
                <p class="text-white/90 text-sm leading-relaxed max-w-[260px] mt-3">Empowering Kenyan students to gain practical digital skills for the modern economy.</p>
            </div>
            <div class="cc-footer-links">
                <h4>Learn Portal</h4>
                <ul>
                    <li><a href="../../index.html">Home</a></li>
                    <li><a href="courses.html">All Courses</a></li>
                    <li><a href="dashboard.html">Student Dashboard</a></li>
                    <li><a href="whats-new.html">What's New</a></li>
                </ul>
            </div>
            <div class="cc-footer-links">
                <h4>Resources</h4>
                <ul>
                    <li><a href="https://coursecornerkenya.com">Main Site</a></li>
                    <li><a href="https://coursecornerkenya.com/pages/privacy-policy.html">Privacy Policy</a></li>
                    <li><a href="https://coursecornerkenya.com/pages/terms-of-service.html">Terms of Service</a></li>
                </ul>
            </div>
            <div>
                <h4 class="text-white font-bold uppercase tracking-widest text-xs mb-5">Contact</h4>
                <ul class="space-y-3 text-sm" style="list-style:none;">
                    <li class="flex items-center gap-3 text-white/85"><i class="fas fa-envelope text-white"></i> info.coursecorner@gmail.com</li>
                    <li class="flex items-center gap-3 text-white/85"><i class="fas fa-phone text-white"></i> 0718 744780</li>
                    <li class="flex items-center gap-3 text-white/85"><i class="fas fa-map-marker-alt text-white"></i> Nairobi, Kenya</li>
                </ul>
            </div>
        </div>
        <div class="cc-footer-bottom"><p>&copy; 2026 Course Corner. All rights reserved.</p></div>
    </div>
</footer>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";
    import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

    const app = initializeApp({
        apiKey:"AIzaSyCt_mM9mwRg0QJpHC4haH7ZsLspVNJI6XM",
        authDomain:"course-corner.firebaseapp.com",
        projectId:"course-corner",
        storageBucket:"course-corner.firebasestorage.app",
        messagingSenderId:"961706784572",
        appId:"1:961706784572:web:7aa6c24946570ffda59039"
    });
    const auth = getAuth(app);
    const db = getFirestore(app);

    let allCourses = [];

    // Auto-fill email if signed in
    onAuthStateChanged(auth, user => {
        if (user) {
            const emailInput = document.getElementById('appEmail');
            const nameInput = document.getElementById('appName');
            if (emailInput && !emailInput.value) emailInput.value = user.email || '';
            if (nameInput && !nameInput.value && user.displayName) nameInput.value = user.displayName;
        }
    });

    // Load courses & populate dropdown
    async function init() {
        try {
            const resp = await fetch('../../data/courses.json');
            allCourses = await resp.json();
            const sel = document.getElementById('courseSelect');
            allCourses.forEach(c => {
                const opt = document.createElement('option');
                opt.value = c.id;
                opt.textContent = `${c.title} — ${c.currency} ${c.fee.toLocaleString()} (${c.duration})`;
                sel.appendChild(opt);
            });

            // Pre-select from URL param
            const params = new URLSearchParams(window.location.search);
            const courseParam = params.get('course');
            if (courseParam) {
                sel.value = courseParam;
                window.onCourseChange();
            }
        } catch (err) {
            console.error('Failed to load courses:', err);
        }
    }

    // Show course card + syllabus on selection
    window.onCourseChange = () => {
        const sel = document.getElementById('courseSelect');
        const card = document.getElementById('courseCard');
        const syllabusSection = document.getElementById('syllabusSection');
        const syllabusContent = document.getElementById('syllabusContent');
        const learnMoreBtn = document.getElementById('learnMoreBtn');
        const c = allCourses.find(x => x.id === sel.value);
        if (!c) { card.classList.add('hidden'); syllabusSection.classList.add('hidden'); return; }

        card.classList.remove('hidden');
        document.getElementById('cardTitle').textContent = c.title;
        document.getElementById('cardMeta').textContent = `${c.modulesCount} Modules · ${c.duration}`;
        document.getElementById('cardFee').textContent = `${c.currency} ${c.fee.toLocaleString()}`;
        document.getElementById('cardLevel').textContent = c.level;
        document.getElementById('cardDuration').textContent = c.duration;
        document.getElementById('courseIcon').style.background = c.gradient;
        document.getElementById('courseIcon').innerHTML = `<i class="${c.icon}"></i>`;
        document.getElementById('appliedCourseId').value = c.id;

        // Show syllabus
        if (c.syllabus && c.syllabus.length) {
            syllabusSection.classList.remove('hidden');
            syllabusContent.innerHTML = c.syllabus.map(s => `
                <div class="flex gap-3 p-3 rounded-xl bg-gray-50 border border-gray-100">
                    <div class="w-10 h-10 rounded-lg bg-[#16a34a]/10 flex items-center justify-center flex-shrink-0">
                        <i class="fas fa-calendar-week text-[#16a34a] text-sm"></i>
                    </div>
                    <div>
                        <p class="text-xs font-bold text-[#16a34a] uppercase tracking-wider">${s.week}</p>
                        <p class="text-sm font-bold text-gray-900">${s.title}</p>
                        <p class="text-xs text-gray-500 mt-0.5">${s.topics.join(' · ')}</p>
                    </div>
                </div>
            `).join('');
            learnMoreBtn.href = `course-detail.html?id=${c.id}`;
        } else {
            syllabusSection.classList.add('hidden');
        }
    };

    // Submit application to Firestore
    document.getElementById('applyForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const btn = e.target.querySelector('button[type="submit"]');
        const formData = new FormData(e.target);
        const data = Object.fromEntries(formData.entries());
        data.timestamp = new Date().toISOString();
        data.status = 'pending';
        data.userId = auth.currentUser ? auth.currentUser.uid : 'anonymous';

        // Get course details
        const c = allCourses.find(x => x.id === data.courseId);
        if (c) {
            data.courseTitle = c.title;
            data.courseFee = c.fee;
            data.courseCurrency = c.currency;
        }

        btn.disabled = true;
        btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Submitting...';

        try {
            await setDoc(doc(db, "learnApplications", `${Date.now()}_${data.whatsapp}`), data);
            Swal.fire({
                icon: 'success',
                title: 'Application Received!',
                html: `<p>We'll contact you on <strong>WhatsApp</strong> with enrollment details shortly.</p>
                       <p class="mt-3 text-sm text-gray-500">You can now proceed to make payment.</p>`,
                confirmButtonColor: '#16a34a',
                confirmButtonText: 'Proceed to Payment'
            }).then(r => {
                if (r.isConfirmed && data.courseId) {
                    window.location.href = `payment.html?course=${data.courseId}&email=${encodeURIComponent(data.email)}`;
                }
            });
            e.target.reset();
            document.getElementById('courseCard').classList.add('hidden');
            document.getElementById('syllabusSection').classList.add('hidden');
        } catch (err) {
            console.error(err);
            Swal.fire({ icon: 'error', title: 'Submission Failed', text: 'Please try again later.', confirmButtonColor: '#16a34a' });
        } finally {
            btn.disabled = false;
            btn.innerHTML = '<i class="fas fa-paper-plane"></i> Submit Application';
        }
    });

    init();
</script>

<script>
    // Mobile menu
    document.addEventListener('DOMContentLoaded', () => {
        const mmBtn = document.getElementById('mobileMenuBtn');
        const mm = document.getElementById('mobileMenu');
        if (mmBtn && mm) {
            mmBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                mm.classList.toggle('show');
                mmBtn.classList.toggle('active');
            });
        }
        document.addEventListener('click', (e) => {
            const mm = document.getElementById('mobileMenu');
            const mmBtn = document.getElementById('mobileMenuBtn');
            if (mm && mm.classList.contains('show') && !mm.contains(e.target) && !mmBtn.contains(e.target)) {
                mm.classList.remove('show');
                mmBtn.classList.remove('active');
            }
        });
    });
    window.closeMobileMenu = () => {
        const mm = document.getElementById('mobileMenu');
        const mmBtn = document.getElementById('mobileMenuBtn');
        if (mm) mm.classList.remove('show');
        if (mmBtn) mmBtn.classList.remove('active');
    };
    window.addEventListener('scroll', () => {
        const h = document.getElementById('learnHeader');
        if (h) h.classList.toggle('scrolled', scrollY > 10);
    });
</script>
</body>
</html>
